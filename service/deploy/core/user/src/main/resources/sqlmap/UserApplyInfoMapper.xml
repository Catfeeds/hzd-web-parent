<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.hzcf.platform.core.user.data.UserApplyInfo" >
  <resultMap id="BaseResultMap" type="UserApplyInfo" >
    <result column="apply_id" property="applyId" jdbcType="VARCHAR" />
    <result column="user_id" property="userId" jdbcType="VARCHAR" />
    <result column="loan_purpose_one" property="loanPurposeOne" jdbcType="VARCHAR" />
    <result column="loan_purpose_two" property="loanPurposeTwo" jdbcType="VARCHAR" />
    <result column="min_apply_amount" property="minApplyAmount" jdbcType="DECIMAL" />
    <result column="max_apply_amount" property="maxApplyAmount" jdbcType="DECIMAL" />
    <result column="max_monthly_payment" property="maxMonthlyPayment" jdbcType="DECIMAL" />
    <result column="status" property="status" jdbcType="VARCHAR" />
    <result column="apply_submit_time" property="applySubmitTime" jdbcType="TIMESTAMP" />
    <result column="period" property="period" jdbcType="VARCHAR" />
  </resultMap>
  
  <resultMap id="queryForListMap" type="com.hzcf.platform.core.user.model.UserApplyInfoVO">
  		<!-- 附加字段 -->
       <id column="apply_id" property="applyId" jdbcType="VARCHAR" />
    	<result column="mobile" property="mobile" jdbcType="VARCHAR" />
	    <result column="name" property="name" jdbcType="VARCHAR" />
	    <result column="id_card" property="idCard" jdbcType="VARCHAR" />
		<!-- 借款人申请信息字段 -->	    

        <result column="user_id" property="userId" jdbcType="VARCHAR" />
	    <result column="loan_purpose_one" property="loanPurposeOne" jdbcType="VARCHAR" />
	    <result column="loan_purpose_two" property="loanPurposeTwo" jdbcType="VARCHAR" />
	    <result column="min_apply_amount" property="minApplyAmount" jdbcType="DECIMAL" />
	    <result column="max_apply_amount" property="maxApplyAmount" jdbcType="DECIMAL" />
	    <result column="max_monthly_payment" property="maxMonthlyPayment" jdbcType="DECIMAL" />
	    <result column="status" property="status" jdbcType="VARCHAR" />
	    <result column="apply_submit_time" property="applySubmitTime" jdbcType="TIMESTAMP" />
	    <result column="period" property="period" jdbcType="VARCHAR" />
   </resultMap>
      
  <sql id="Base_Column_List" >
    apply_id, user_id, loan_purpose_one, loan_purpose_two, min_apply_amount, max_apply_amount, 
    max_monthly_payment, status, apply_submit_time,period
  </sql>
  <select id="selectByUserId" resultMap="BaseResultMap" parameterType="java.lang.String" >
    select 
    <include refid="Base_Column_List" />
    from user_apply_info
    where user_id = #{userId,jdbcType=VARCHAR}
  </select>

  <select id="selectByApplyId" resultMap="BaseResultMap" parameterType="java.lang.String" >
    select
    <include refid="Base_Column_List" />
    from user_apply_info
    where apply_id = #{applyId,jdbcType=VARCHAR}
  </select>
  <delete id="deleteByPrimaryKey" parameterType="java.lang.String" >
    delete from user_apply_info
    where apply_id = #{applyId,jdbcType=VARCHAR}
  </delete>
  <insert id="insert" parameterType="UserApplyInfo" >
    insert into user_apply_info (apply_id, user_id, loan_purpose_one, 
      loan_purpose_two, min_apply_amount, max_apply_amount, 
      max_monthly_payment, status, apply_submit_time,period
      )
    values (#{applyId,jdbcType=VARCHAR}, #{userId,jdbcType=VARCHAR}, #{loanPurposeOne,jdbcType=VARCHAR}, 
      #{loanPurposeTwo,jdbcType=VARCHAR}, #{minApplyAmount,jdbcType=DECIMAL}, #{maxApplyAmount,jdbcType=DECIMAL}, 
      #{maxMonthlyPayment,jdbcType=DECIMAL}, #{status,jdbcType=VARCHAR}, #{applySubmitTime,jdbcType=TIMESTAMP}, #{period,jdbcType=VARCHAR}
      )
  </insert>
  <insert id="insertSelective" parameterType="UserApplyInfo" >
    insert into user_apply_info
    <trim prefix="(" suffix=")" suffixOverrides="," >
      <if test="applyId != null" >
        apply_id,
      </if>
      <if test="userId != null" >
        user_id,
      </if>
      <if test="loanPurposeOne != null" >
        loan_purpose_one,
      </if>
      <if test="loanPurposeTwo != null" >
        loan_purpose_two,
      </if>
      <if test="minApplyAmount != null" >
        min_apply_amount,
      </if>
      <if test="maxApplyAmount != null" >
        max_apply_amount,
      </if>
      <if test="maxMonthlyPayment != null" >
        max_monthly_payment,
      </if>
      <if test="status != null" >
        status,
      </if>
      <if test="applySubmitTime != null" >
        apply_submit_time,
      </if>
      <if test="period != null" >
        period
      </if>
    </trim>
    <trim prefix="values (" suffix=")" suffixOverrides="," >
      <if test="applyId != null" >
        #{applyId,jdbcType=VARCHAR},
      </if>
      <if test="userId != null" >
        #{userId,jdbcType=VARCHAR},
      </if>
      <if test="loanPurposeOne != null" >
        #{loanPurposeOne,jdbcType=VARCHAR},
      </if>
      <if test="loanPurposeTwo != null" >
        #{loanPurposeTwo,jdbcType=VARCHAR},
      </if>
      <if test="minApplyAmount != null" >
        #{minApplyAmount,jdbcType=DECIMAL},
      </if>
      <if test="maxApplyAmount != null" >
        #{maxApplyAmount,jdbcType=DECIMAL},
      </if>
      <if test="maxMonthlyPayment != null" >
        #{maxMonthlyPayment,jdbcType=DECIMAL},
      </if>
      <if test="status != null" >
        #{status,jdbcType=VARCHAR},
      </if>
      <if test="applySubmitTime != null" >
        #{applySubmitTime,jdbcType=TIMESTAMP},
      </if>
      <if test="period != null" >
        #{period,jdbcType=VARCHAR},
      </if>
    </trim>
  </insert>
  <update id="updateByPrimaryKeySelective" parameterType="UserApplyInfo" >
    update user_apply_info
    <set >
      <if test="userId != null" >
        user_id = #{userId,jdbcType=VARCHAR},
      </if>
      <if test="loanPurposeOne != null" >
        loan_purpose_one = #{loanPurposeOne,jdbcType=VARCHAR},
      </if>
      <if test="loanPurposeTwo != null" >
        loan_purpose_two = #{loanPurposeTwo,jdbcType=VARCHAR},
      </if>
      <if test="minApplyAmount != null" >
        min_apply_amount = #{minApplyAmount,jdbcType=DECIMAL},
      </if>
      <if test="maxApplyAmount != null" >
        max_apply_amount = #{maxApplyAmount,jdbcType=DECIMAL},
      </if>
      <if test="maxMonthlyPayment != null" >
        max_monthly_payment = #{maxMonthlyPayment,jdbcType=DECIMAL},
      </if>
      <if test="status != null" >
        status = #{status,jdbcType=VARCHAR},
      </if>
      <if test="applySubmitTime != null" >
        apply_submit_time = #{applySubmitTime,jdbcType=TIMESTAMP},
      </if>
      <if test="period != null" >
        period = #{period,jdbcType=VARCHAR},
      </if>
    </set>
    where apply_id = #{applyId,jdbcType=VARCHAR}
  </update>
  <update id="updateByPrimaryKey" parameterType="UserApplyInfo" >
    update user_apply_info
    set user_id = #{userId,jdbcType=VARCHAR},
      loan_purpose_one = #{loanPurposeOne,jdbcType=VARCHAR},
      loan_purpose_two = #{loanPurposeTwo,jdbcType=VARCHAR},
      min_apply_amount = #{minApplyAmount,jdbcType=DECIMAL},
      max_apply_amount = #{maxApplyAmount,jdbcType=DECIMAL},
      max_monthly_payment = #{maxMonthlyPayment,jdbcType=DECIMAL},
      status = #{status,jdbcType=VARCHAR},
      apply_submit_time = #{applySubmitTime,jdbcType=TIMESTAMP},
      period = #{period,jdbcType=VARCHAR}
    where apply_id = #{applyId,jdbcType=VARCHAR}
  </update>
  
  	 <sql id="Base_Where_Clause">
	    <if test="apply.name != null and apply.name !=''"> and name like CONCAT('%',#{apply.name},'%')     </if>
	    <if test="apply.mobile != null and apply.mobile != ''"> and mobile=#{apply.mobile} </if>
	    <if test="apply.startDate != null and apply.startDate !='' and apply.endDate != null and apply.endDate != ''">
	        and date_format(create_time, '%Y-%m-%d') BETWEEN #{apply.startDate} AND #{apply.endDate} 
	    </if>
	  </sql>
  	<!-- 分页查询 -->
	<select id="FINDLIST" resultMap="queryForListMap" parameterType="java.util.Map">
		SELECT u.mobile, u.name, u.id_card, a.user_id, a.loan_purpose_one, a.loan_purpose_two, 
		a.min_apply_amount, a.max_apply_amount, a.max_monthly_payment, a.apply_submit_time, a.status,a.period
		FROM users u INNER JOIN user_apply_info a
		ON u.id = a.user_id
	    <where>
	      <include refid="Base_Where_Clause"/>
	    </where>
		ORDER BY a.apply_submit_time DESC
	    <if test="page.page > 0">
	    LIMIT #{page.start},#{page.end}
	    </if>
	</select>
	
	<select id="FINDLIST_COUNT" resultType="long" parameterType="java.util.Map">
		SELECT COUNT(1) FROM users u INNER JOIN user_apply_info a
		ON u.id = a.user_id
	    <where>
	      <include refid="Base_Where_Clause"/>
	    </where>
	</select>	
	
	<select id="FINDLIST_SEARCH" resultMap="queryForListMap" parameterType="java.util.Map">
		SELECT u.mobile, u.name, u.id_card, a.user_id, a.loan_purpose_one, a.loan_purpose_two, 
		a.min_apply_amount, a.max_apply_amount, a.max_monthly_payment, a.apply_submit_time, a.status,a.period
		FROM users u INNER JOIN user_apply_info a
		ON u.id = a.user_id
	    <where>
	      <include refid="Base_Where_Clause"/>
	    </where>
		ORDER BY a.apply_submit_time DESC
	</select>	
	
	
</mapper>
